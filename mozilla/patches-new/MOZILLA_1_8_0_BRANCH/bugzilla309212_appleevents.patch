Index: toolkit/xre/nsCommandLineServiceMac.cpp
===================================================================
RCS file: /cvsroot/mozilla/toolkit/xre/nsCommandLineServiceMac.cpp,v
retrieving revision 1.3
diff -d -u -r1.3 nsCommandLineServiceMac.cpp
--- toolkit/xre/nsCommandLineServiceMac.cpp	19 Feb 2005 22:41:59 -0000	1.3
+++ toolkit/xre/nsCommandLineServiceMac.cpp	19 Sep 2005 22:34:10 -0000
@@ -48,6 +48,7 @@
 #include "nsNetUtil.h"
 #include "nsIAppStartup.h"
 #include "nsIServiceManager.h"
+#include "nsIObserverService.h"
 #include "nsIURL.h"
 #include "nsIIOService.h"
 #include "nsIURL.h"
@@ -85,7 +86,7 @@
 static PRInt32 ReadLine(FILE* inStream, char* buf, PRInt32 bufSize)
 {
   PRInt32 charsRead = 0;
-  int c;
+  int c = EOF;
   
   if (bufSize < 2)
     return -1;
@@ -292,6 +293,13 @@
 
 OSErr nsMacCommandLine::OpenURL(const char* aURL)
 {
+#if 1 // XXX Komodo patch to get apple events handle events in javascript
+  nsCOMPtr<nsIObserverService> observerService = do_GetService("@mozilla.org/observer-service;1");
+  if (observerService) {
+    observerService->NotifyObservers(nsnull, "open-url", NS_ConvertASCIItoUCS2(aURL).get());
+  }
+  return noErr;
+#else
   nsresult rv;
   
   nsCOMPtr<nsIPrefBranch> prefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID, &rv));
@@ -310,6 +318,7 @@
     return errAEEventNotHandled;
     
   return noErr;
+#endif
 }
 
 
